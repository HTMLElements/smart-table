
/* Smart UI v8.0.0 (2020-Aug) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=71)}({71:function(e,t){Smart("smart-list-item",class extends Smart.ContentElement{static get properties(){return{alternationIndex:{value:-1,type:"int"},color:{value:"",type:"string"},displayMode:{allowedValues:["plain","checkBox","radioButton"],value:"plain",type:"string"},grouped:{value:!1,type:"boolean"},selected:{value:!1,type:"boolean"},value:{value:"",type:"string"},label:{value:"",type:"string"},details:{value:"",type:"string"},group:{value:"",type:"string"},hidden:{value:!1,type:"boolean"},readonly:{value:!1,type:"boolean"}}}get hasStyleObserver(){return!1}get enableShadowDOM(){return!1}get _focused(){const e=this;return void 0===e.__focused&&(e.__focused=!1),e.__focused}set _focused(e){const t=this;t.__focused=e,e?(t.setAttribute("focus",""),t.ownerListBox&&t.ownerListBox.ownerElement&&Smart.ComboBox&&t.ownerListBox.ownerElement instanceof Smart.ComboBox&&t.ownerListBox.ownerElement.$.input.setAttribute("aria-activedescendant",t.id)):t.removeAttribute("focus")}template(){return'<div id="container">\n                   <span id=\'itemInput\' class=\'smart-input smart-hidden\'></span>\n                    <span class="smart-overlay" id="overlay"></span>\n                    <div id="itemContainer" class="smart-content smart-list-item-container"><span class="smart-content-label" inner-h-t-m-l=\'[[innerHTML]]\' role="presentation"><content></content></span><span inner-h-t-m-l=\'[[details]]\' id="details" class="smart-content-details"></span></div>\n                </div>'}appendChild(e){const t=this;if(!t.isCompleted||e.classList.contains("smart-ripple")){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}t.$.itemContainer.innerHTML="",e instanceof HTMLElement&&t.$.itemContainer.appendChild(e)}insertBefore(e,t){const i=this;if(!i.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.insertBefore.apply(i,e.concat(Array.prototype.slice.call(arguments)))}t.parentNode.insertBefore(e,t)}removeChild(e){const t=this;if(!t.isCompleted||e.classList.contains("smart-ripple")){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.itemContainer.removeChild(e)}attached(){super.attached(),this.ownerListBox=this.getListBox()}static get listeners(){return{mouseenter:"_itemOnMouseEnter",mouseleave:"_itemOnMouseLeave"}}ready(){super.ready();const e=this;e.setAttribute("role","option"),""!==e.label?e.innerHTML=e.label:""!==e.innerHTML&&(e.label=e.innerHTML),e._setDisplayMode(e.displayMode),e._setItemColor(),e.$.container.noRipple=!0}propertyChangedHandler(e,t,i){const o=this;if(super.propertyChangedHandler(e,t,i),"hidden"===e)i?o.$.addClass("smart-hidden"):o.$.removeClass("smart-hidden");else if("color"===e)o._setItemColor();else if("displayMode"===e)o._setDisplayMode(i);else if("label"===e||"value"===e){const t=o.context;o.context=document,"label"===e&&(o.innerHTML=i);const r=o.getListBox();r._applyTemplate(o),r.onItemUpdated(o),o.context=t}else if("details"===e){const e=o.context;o.context=document,o.$.details.innerHTML=i,o.getListBox().onItemUpdated(o),o.context=e}else if("innerHTML"===e){o.getListBox().onItemUpdated(o)}else if("selected"===e)if(i)o.setAttribute("aria-selected",!0);else{const e=o.getListBox();o.readonly||o.disabled||!e||-1===["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox"].indexOf(e.selectionMode)?o.removeAttribute("aria-selected"):o.setAttribute("aria-selected",!1)}}getListBox(){const e=this;let t=e.parentNode;for(;t instanceof Smart.ListBox==!1&&null!==t;)t=t.parentNode;return!t&&Smart.EnableShadowDOM?e.getRootNode().host:t}_itemOnMouseEnter(){const e=this;!e.disabled&&e.ownerListBox&&(Smart.ListBox.DragDrop.Dragging&&e.ownerListBox.allowDrop&&(Smart.ListBox.DragDrop.DropDetails={item:e,position:"bottom"}),e.ownerListBox.$.verticalScrollBar.thumbCapture||e.ownerListBox.$.horizontalScrollBar.thumbCapture||e.setAttribute("hover",""))}_itemOnMouseMove(e){const t=this;if(t.ownerListBox&&Smart.ListBox.DragDrop.Dragging&&t.ownerListBox.allowDrop&&!Smart.Utilities.Core.isMobile){const i=[].slice.call(t.ownerListBox.getElementsByClassName("smart-list-item-bottom-line-feedback"));for(let e=0;e<i.length;e++)i[e].$.removeClass("smart-list-item-line-feedback"),i[e].$.removeClass("smart-list-item-bottom-line-feedback");if(Smart.ListBox.DragDrop.DropDetails={item:t,position:"top"},!t.ownerListBox._areCSSVarsSupported){if(t.ownerListBox._indexOf(t)===t.ownerListBox._items.length-1||t.parentNode.lastElementChild===t){const i=t.getBoundingClientRect();e.pageY-window.pageYOffset>i.top+i.height/2-1&&(Smart.ListBox.DragDrop.DropDetails={item:t,position:"bottom"})}return}if(t.$.removeClass("smart-list-item-line-feedback"),t.$.removeClass("smart-list-item-bottom-line-feedback"),t.ownerListBox.sorted&&t.ownerListBox.autoSort)return;const o=t.ownerListBox._items.filter(e=>!e.hidden);if(o.indexOf(t)===o.length-1||t.parentNode.lastElementChild===t){const i=t.getBoundingClientRect();e.pageY-window.pageYOffset>i.top+i.height/2-1?(t.$.addClass("smart-list-item-bottom-line-feedback"),Smart.ListBox.DragDrop.DropDetails={item:t,position:"bottom"}):arguments[1]||t.$.addClass("smart-list-item-line-feedback")}else arguments[1]||t.$.addClass("smart-list-item-line-feedback")}}_itemOnMouseLeave(){const e=this;e.ownerListBox&&(Smart.ListBox.DragDrop.Dragging&&(e.$.removeClass("smart-list-item-line-feedback"),e.$.removeClass("smart-list-item-bottom-line-feedback")),e.removeAttribute("hover"))}_setDisplayMode(e){const t=this,i=t.getListBox();if(i){const o="checkBox"===i.selectionMode||"radioButton"===i.selectionMode?i.selectionMode:"plain";t.displayMode=e=o}"plain"!==e?t.$itemInput.removeClass("smart-hidden"):t.$itemInput.addClass("smart-hidden")}_setItemColor(){const e=this.querySelector(".smart-content-label"),t=/(^#[0-9A-F]{3}$)|(^#[0-9A-F]{6}$)|(^#[0-9A-F]{8}$)/i.test(this.color)?this.color:"";e.style.backgroundColor=t,e.style.color=this._getContrastColor(t)}_getContrastColor(e){if(!e)return"";let t=(i=e.slice(1,3),o=e.slice(3,5),r=e.slice(5,7),[parseInt(i,16),parseInt(o,16),parseInt(r,16)]);var i,o,r;return parseFloat(((.299*t[0]+.61*t[1]+.114*t[2])/255).toFixed(2))>.65?"#000000":"#FFFFFF"}}),Smart("smart-list-items-group",class extends Smart.ContentElement{static get properties(){return{label:{value:"",type:"string"}}}get enableShadowDOM(){return!1}template(){return'<div id="container" role="presentation">\n                 <span id="itemsLabel" class="smart-list-items-group-label">[[label]]</span>\n                 <div id="listItemsGroupContainer" inner-h-t-m-l=\'[[innerHTML]]\' class="smart-list-items-group-container" role="presentation">\n                    <content></content>\n                 </div>\n               </div>'}appendChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.listItemsGroupContainer.appendChild(e)}removeChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.listItemsGroupContainer.removeChild(e)}getListBox(){let e=this.parentNode;for(;e instanceof Smart.ListBox==!1&&null!==e;)e=e.parentNode;return e}attached(){const e=this;super.attached(),e.ownerListBox||(e.ownerListBox=e.getListBox()),e.setAttribute("role","group"),e.$.itemsLabel.id||(e.$.itemsLabel.id=e.id+"Label"),e.setAttribute("aria-labelledby",e.$.itemsLabel.id)}}),Smart("smart-list-box",class extends Smart.ScrollViewer{static get properties(){return{allowDrag:{value:!1,type:"boolean"},allowDrop:{value:!1,type:"boolean"},alternationStart:{value:0,type:"int"},alternationEnd:{value:0,type:"int"},alternationCount:{value:0,type:"int"},autoSort:{value:!0,type:"boolean"},dataSource:{value:null,type:"any?",reflectToAttribute:!1},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},displayLoadingIndicator:{value:!1,type:"boolean"},displayMember:{value:"",type:"string"},shadowDomMode:{allowedValues:["light","shadow"],value:"shadow",type:"string"},dropAction:{value:"move",type:"string",allowedValues:["copy","move","none"]},editable:{value:!1,type:"boolean"},filterable:{value:!1,type:"boolean"},filterCallback:{value:null,type:"function?"},filterMode:{value:"containsIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase","custom"],type:"string"},filterInputPlaceholder:{value:"",type:"string"},grouped:{value:!1,type:"boolean"},groupMember:{value:"",type:"string"},itemTemplate:{value:null,type:"any"},itemHeight:{value:null,type:"number?"},incrementalSearchDelay:{value:700,type:"number?"},incrementalSearchMode:{value:"startsWithIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},itemMeasureMode:{value:"auto",allowedValues:["auto","precise"],type:"string"},loadingIndicatorPlaceholder:{value:"Loading...",type:"string"},loadingIndicatorPosition:{value:"center",allowedValues:["bottom","center","top"],type:"string"},messages:{extend:!0,value:{en:{overridingProperties:'{{elementType}}: Overriding properties {{property1}} and {{property2}} applied. The "{{property1}}" property is used by default.',invalidIndex:'{{elementType}}: "{{method}}" method accepts an index of type number or an Array of numbers.',indexOutOfBound:'{{elementType}}: Out of bound index/indexes in "{{method}}" method.',invalidItem:'{{elementType}}: "{{method}}" method accepts an object or an array of objects as it\'s second parameter.',invalidSettings:'{{elementType}}: "{{method}}" method accepts a string or an object as it\'s second parameter.'}},type:"object"},name:{value:"",type:"string"},placeholder:{value:"No Items",type:"string"},selectedIndexes:{value:[],type:"array"},selectedValues:{value:[],type:"array"},selectionMode:{value:"oneOrManyExtended",allowedValues:["none","oneOrManyExtended","zeroOrMany","oneOrMany","zeroOrOne","one","checkBox","radioButton"],type:"string"},selectionChangeAction:{value:"release",allowedValues:["press","release"],type:"string"},sorted:{value:!1,type:"boolean"},sortDirection:{value:"asc",type:"string"},topVisibleIndex:{value:-1,type:"int"},type:{value:"list",type:"string",defaultReflectToAttribute:!0,readonly:!0},valueMember:{value:"",type:"string"},virtualized:{value:!1,type:"boolean"}}}static get requires(){return{"Smart.ScrollBar":"smart.scrollbar.js"}}static get styleUrls(){return["smart.listbox.css","smart.dropdown.css","smart.scrollbar.css"]}static get listeners(){return{focus:"_focusHandler",blur:"_blurHandler","container.wheel":"_mouseWheelHandler","editInput.change":"_editInputEventHandler","editInput.blur":"_editInputEventHandler","editInput.keydown":"_editInputEventHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","itemsInnerContainer.down":"_downHandler","itemsInnerContainer.dblclick":"_dblclickEventHandler","itemsInnerContainer.move":"_itemsContainerMoveHandler","itemsContainer.mouseleave":"_mouseLeaveHandler","itemsInnerContainer.touchmove":"_touchmoveHandler","itemsInnerContainer.touchstart":"_touchstartHandler","document.move":"_moveHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler",resize:"_resizeHandler",selectstart:"_selectStartHandler",styleChanged:"_styleChangedHandler",swipeleft:"_swipeLeftHandler",swiperight:"_swipeRightHandler",touchmove:"_overriddenHandler",touchstart:"_overriddenHandler","verticalScrollBar.change":"_verticalScrollbarHandler"}}template(){return'<div id="container" class="smart-container" role="presentation">\n                    <div class="smart-list-box-filter-input-container smart-hidden" id="filterInputContainer" role="presentation"><input id="filterInput" disabled="[[disabled]]" placeholder=\'[[filterInputPlaceholder]]\' role="searchbox" aria-label="[[filterInputPlaceholder]]"></div>\n                    <div id="itemsContainer" class="smart-list-items-container" role="presentation">\n                        <div id="placeholder" class="smart-placeholder" role="presentation" aria-hidden="true">[[placeholder]]</div>\n                        <div id="itemsInnerContainer" inner-h-t-m-l=\'[[innerHTML]]\' class="smart-list-items-inner-container" role="presentation">\n                            <content></content>\n                        </div>\n                        <input type="text" id="editInput" class= "smart-hidden"/>\n                    </div>\n                    <smart-scroll-bar wait right-to-left="[[rightToLeft]]" id="verticalScrollBar" disabled="[[disabled]]" orientation="vertical"></smart-scroll-bar>\n                    <smart-scroll-bar wait right-to-left="[[rightToLeft]]" id="horizontalScrollBar" disabled="[[disabled]]"></smart-scroll-bar>\n                    <div id="loadingIndicatorContainer" class="smart-loader-container" role="presentation">\n                        <span id="loadingIndicator" class="smart-loader" role="img" aria-label="[[loadingIndicatorPlaceholder]]"></span>\n                        <span id="loadingIndicatorPlaceHolder" class="smart-loader-label smart-hidden">[[loadingIndicatorPlaceholder]]</span>\n                    </div>\n                    <input id="hiddenInput" type="hidden" name="[[name]]">\n                </div>'}get value(){const e=this;return e.isRendered&&e._selectedItems.length>0?e._selectedItems.map(e=>({label:e.label,value:e.value})):null}set value(e){const t=this;if(Array.isArray(e)){const i=t.context;t.context=t,t._isUpdating++,t.selectedValues=[],t.clearSelection();for(let i=0;i<e.length;i++){const o=e[i],r=t.getItem(o);r&&("oneOrManyExtended"===t.selectionMode?t._select(r):t.select(r))}return t.context=i,void t._isUpdating--}const i=t.getItem(e);i&&t.select(i)}get _selectedItems(){const e=this,t=[];if(e.isRendered)for(let i=0;i<e._items.length;i++){const o=e._items[i];o.selected&&t.push(o)}return t}_mouseLeaveHandler(){const e=[].slice.call(this.getElementsByClassName("smart-list-item-bottom-line-feedback"));for(let t=0;t<e.length;t++)e[t].$.removeClass("smart-list-item-line-feedback"),e[t].$.removeClass("smart-list-item-bottom-line-feedback")}_downHandler(e){const t=this;if(t.disabled||t.displayLoadingIndicator||t.readonly)return;let i=e.originalEvent.target,o=null;if(!(i instanceof Smart.ListItem)||i.disabled||i.hidden||i instanceof Smart.ListItemsGroup)for(;i.parentElement;){if(i instanceof Smart.ListItem&&!i.disabled&&!i.hidden&&!(i instanceof Smart.ListItemsGroup)){o=i.dataItem;break}i=i.parentElement}else o=i.dataItem;Smart.ListBox.DragDrop.StartTime=new Date,Smart.ListBox.DragDrop.StartPosition={left:e.pageX,top:e.pageY},o&&(e.stopPropagation(),t.hasRippleAnimation&&(o.readonly||o.disabled||Smart.Utilities.Animation.Ripple.animate(i.$.overlay,e.pageX,e.pageY)),Smart.Utilities.Core.isMobile||"press"!==t.selectionChangeAction||(t._focus(o),t.select(o)),!Smart.ListBox.DragDrop.Feedback&&t.allowDrag&&(Smart.ListBox.DragDrop.DraggedFrom=t,Smart.ListBox.DragDrop.Feedback=document.createElement("span"),t.rightToLeft?Smart.ListBox.DragDrop.Feedback.setAttribute("right-to-left",!0):Smart.ListBox.DragDrop.Feedback.removeAttribute("right-to-left"),t.dragFeedbackFormatFunction?Smart.ListBox.DragDrop.Feedback.innerHTML=t.dragFeedbackFormatFunction(o):Smart.ListBox.DragDrop.Feedback.appendChild(o.offsetHeight?o.cloneNode(!0):t._createItem(o)),Smart.ListBox.DragDrop.Item=o,Smart.Utilities.Extend(Smart.ListBox.DragDrop.Feedback).addClass("smart-popup smart-list-item smart-list-item-feedback")))}_dblclickEventHandler(e){const t=this;if(!t.editable)return;const i=e.target.closest("smart-list-item");i instanceof Smart.ListItem&&!i.disabled&&!i.readonly?(t.$.editInput.dir=t.rightToLeft?"rtl":"ltr",t.$.editInput.style.width=t.$.itemsInnerContainer.offsetWidth+"px",t.$.editInput.owner=i,t.$.editInput.value=i.label,t.$.editInput.style.height=i.offsetHeight+"px",t.$.editInput.style.top=i.offsetTop+t.$.itemsInnerContainer.offsetTop+"px",t.$.editInput.setAttribute("aria-label","Edit item "+i.label),t.$editInput.hasClass("smart-hidden")&&t.$editInput.removeClass("smart-hidden"),t.$.editInput.focus({preventScroll:!0})):t.$editInput.addClass("smart-hidden")}_editInputEventHandler(e){const t=this;if("blur"===e.type||"keydown"===e.type&&"Escape"===e.key)return t.$editInput.hasClass("smart-hidden")||t.$editInput.addClass("smart-hidden"),void t.focus();if("keydown"===e.type||t.$editInput.hasClass("smart-hidden"))return;const i=e.target;if(e.stopPropagation(),i.owner.label!==i.value&&(i.owner.label=i.value,t.itemTemplate&&t._applyTemplate(i.owner),t.dataSource)){const e=i.owner.dataIndex,o=t.dataSource[e];o&&(t.displayMember?o[t.displayMember]=i.value:o.label=i.value)}t.$editInput.addClass("smart-hidden"),t.$.fireEvent("itemLabelChange",{selected:i.owner.selected,disabled:i.owner.disabled,index:t._indexOf(i.owner),label:i.owner.label,value:i.owner.value})}_pointerUpHandler(e){const t=this;let i=e.originalEvent,o=i.target;(t.shadowRoot||t.isInShadowDOM)&&(o=i.originalEvent?i.originalEvent.composedPath()[0]:i.composedPath()[0]);const r=e=>{const i=e.ownerListBox;i.disabled||i!==t||i.displayLoadingIndicator||"none"===i.selectionMode||e.grouped||e.readonly||(i._focus(e),i.select(e),Smart.ListBox.DragDrop.StartPosition=null,t.$.fireEvent("itemClick",{selected:o.selected,disabled:o.disabled,index:t._indexOf(o),label:o.label,value:o.value}))};if(!(i.target instanceof Smart.ListItem)||i.target.disabled||i.target instanceof Smart.ListItemsGroup){for(;o.parentElement;){if(o instanceof Smart.ListItem&&!o.disabled&&!(o instanceof Smart.ListItemsGroup))return void r(o.dataItem);o=o.parentElement}if(this.shadowRoot&&"shadow"===this.shadowDomMode){const e=i.composedPath();for(let t=0;t<e.length;t++){const i=e[t];i instanceof Smart.ListItem&&!i.disabled&&r(i.dataItem)}}}else r(o.dataItem)}_upHandler(e){const t=this;if(super._upHandler(),!t.disabled&&!t.readonly&&Smart.ListBox.DragDrop.StartPosition){if(Smart.Utilities.Core.isMobile&&!Smart.ListBox.DragDrop.Dragging){const i=Math.abs(e.pageX-Smart.ListBox.DragDrop.StartPosition.left),o=Math.abs(e.pageY-Smart.ListBox.DragDrop.StartPosition.top);let r=i>=0&&i<=3&&o>=0&&o<=3;if(Smart.Utilities.Core.isMobile&&new Date-Smart.ListBox.DragDrop.StartTime>=300&&(r=!1,Smart.ListBox.DragDrop.StartTime=null),r){const i=e.originalEvent.target.closest("smart-list-box");i?i._pointerUpHandler(e):t._pointerUpHandler(e),Smart.ListBox.DragDrop.StartPosition=null}else{let t=e.originalEvent.target;if(!(e.target instanceof Smart.ListItem)||t.readonly||e.target.disabled||e.target instanceof Smart.ListItemsGroup)for(;t.parentElement;){if(t instanceof Smart.ListItem&&!t.readonly&&!t.disabled&&!(t instanceof Smart.ListItemsGroup)){e.stopPropagation();break}t=t.parentElement}else e.stopPropagation()}}else if(!Smart.Utilities.Core.isMobile&&!Smart.ListBox.DragDrop.Dragging&&"release"===t.selectionChangeAction){const i=(t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target).closest("smart-list-box");i?i._pointerUpHandler(e):t._pointerUpHandler(e)}if(Smart.ListBox.DragDrop.Feedback){let i;if(Smart.ListBox.DragDrop.Feedback.parentNode&&Smart.ListBox.DragDrop.Feedback.parentNode.removeChild(Smart.ListBox.DragDrop.Feedback),Smart.ListBox.DragDrop.Feedback=null,Smart.Utilities.Core.isMobile&&Smart.ListBox.DragDrop.Dragging)for(let t=0;t<Smart.ListBox.DragDrop.ListBoxes.length;t++){const o=Smart.ListBox.DragDrop.ListBoxes[t],r=o.getBoundingClientRect();if(o.allowDrop&&!o.closest(".smart-visibility-hidden")&&(r.left<=e.clientX&&e.clientX<=r.left+r.width&&r.top<=e.clientY&&e.clientY<=r.top+r.height)){i=o;const t=o._items.filter(e=>!e.hidden);for(let i=0;i<t.length;i++){const n=t[i],s=n.getBoundingClientRect();if((t.indexOf(n)===t.length-1||n.parentNode.lastElementChild===n)&&e.clientY>=r.top+n.offsetTop-o.scrollTop+s.height/2&&e.clientY<=r.top-o.scrollTop+n.offsetTop+s.height){Smart.ListBox.DragDrop.DropDetails={item:n,position:"bottom"};break}if(e.clientY>=r.top+n.offsetTop-o.scrollTop&&e.clientY<=r.top+n.offsetTop+s.height-o.scrollTop){Smart.ListBox.DragDrop.DropDetails={item:n,position:"top"};break}}}}if(Smart.ListBox.DragDrop.Dragging){if(Smart.ListBox.DragDrop.DropDetails){let o=Smart.ListBox.DragDrop.DropDetails.item,r=Smart.ListBox.DragDrop.Item;const n=r.ownerListBox;let s=e.originalEvent.target;if(t.isInShadowDOM&&(s=e.originalEvent?e.originalEvent.composedPath()[0]:e.composedPath()[0]),i=!i&&s.closest?s.closest("smart-list-box"):i,document.body.classList.remove("smart-dragging"),o.$.removeClass("smart-list-item-line-feedback"),o.$.removeClass("smart-list-item-bottom-line-feedback"),i&&o.ownerListBox!==i&&i.items.length>0&&(o=i.items[i.items.length-1]),Smart.ListBox.DragDrop.Item===o||i!==o.ownerListBox&&!Smart.Utilities.Core.isMobile)i&&0===i._items.length&&"none"!==i.dropAction&&("move"===i.dropAction?Smart.ListBox.DragDrop.Item.ownerListBox.removeChild(Smart.ListBox.DragDrop.Item):"copy"===i.dropAction&&(r=r.cloneNode(!0)),i.appendChild(r));else if("none"!==r.ownerListBox.dropAction){o.ownerListBox!==r.ownerListBox&&"move"===r.ownerListBox.dropAction&&Smart.ListBox.DragDrop.Item.ownerListBox.removeChild(Smart.ListBox.DragDrop.Item),"copy"===r.ownerListBox.dropAction&&(r=r.cloneNode(!0)),Smart.ListBox.DragDrop.Item.group=o.group;const e=o.ownerListBox;"checkBox"!==e.selectionMode&&"radioButton"!==e.selectionMode&&e.clearSelection(),"top"===Smart.ListBox.DragDrop.DropDetails.position?e.insertBefore(r,o):o.parentNode.lastElementChild===o?e.appendChild(r):e.appendChild(r,o),e.ensureVisible(r),"checkBox"===e.selectionMode||"radioButton"===e.selectionMode?(e._focus(r),e._refreshSelection()):(e.clearSelection(),e.select(r))}r.selected&&i!==n&&n._refreshSelection();const l=Smart.ListBox.DragDrop.Item,a=l.ownerListBox;l.displayMode="checkBox"===a.selectionMode||"radioButton"===a.selectionMode?a.selectionMode:"plain",a.$.fireEvent("dragEnd",{item:l,target:o,data:Smart.ListBox.DragDrop,previousContainer:n,container:i,originalEvent:e}),a._focus(l)}else{const t=Smart.ListBox.DragDrop.Item,i=t.ownerListBox;t.displayMode="checkBox"===i.selectionMode||"radioButton"===i.selectionMode?i.selectionMode:"plain",document.body.classList.remove("smart-dragging"),i.$.fireEvent("dragEnd",{item:t,target:null,data:Smart.ListBox.DragDrop,previousContainer:i,container:i,originalEvent:e}),i._focus(t)}e.preventDefault()}delete Smart.ListBox.DragDrop.DraggedFrom,Smart.ListBox.DragDrop.Dragging=!1,Smart.ListBox.DragDrop.Item=null,Smart.ListBox.DragDrop.DropDetails=null}for(let e=0;e<Smart.ListBox.DragDrop.ListBoxes.length;e++){const t=Smart.ListBox.DragDrop.ListBoxes[e];t._dragInterval&&clearInterval(t._dragInterval)}}}_itemsContainerMoveHandler(e){const t=this;if(Smart.ListBox.DragDrop.Dragging)return t._applyItemFeedback(e),t._moveHandler(e),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation(),!1}_touchmoveHandler(e){if(Smart.ListBox.DragDrop.Dragging&&e.cancelable)return e.preventDefault(),void e.stopPropagation();super._touchmoveHandler(e)}_applyItemFeedback(e){const t=this,i=e.originalEvent.target,o=i.closest?i.closest("smart-list-item"):i;Smart.Utilities.Core.isMobile?Smart.ListBox.DragDrop.DropDetails={item:Smart.ListBox.DragDrop.Item,position:"bottom"}:0!==t.items.length&&(o?o._itemOnMouseMove(e):t.items[t.items.length-1]._itemOnMouseMove(e,!0))}_moveHandler(e){const t=this;if(!Smart.ListBox.DragDrop.Feedback||Smart.ListBox.DragDrop.DraggedFrom!==t)return;const i=t.dragOffset;if(Smart.ListBox.DragDrop.Dragging){Smart.ListBox.DragDrop.Feedback.style.left=i[0]+e.pageX+"px",Smart.ListBox.DragDrop.Feedback.style.top=i[1]+e.pageY+"px",t.$.fireEvent("dragging",{item:Smart.ListBox.DragDrop.Item,data:Smart.ListBox.DragDrop,originalEvent:e.originalEvent});for(let t=0;t<Smart.ListBox.DragDrop.ListBoxes.length;t++){const i=Smart.ListBox.DragDrop.ListBoxes[t];i._dragInterval&&clearInterval(i._dragInterval),i._dragInterval=setInterval((function(){const t=i.getBoundingClientRect();t.left<=e.clientX&&t.left+t.width>=e.clientX&&(e.clientY>=t.top&&e.clientY<=t.top+20?i.scrollTop-=2:e.clientY>=t.top+t.height-20&&e.clientY<=t.top+t.height&&(i.scrollTop+=2))}),1)}return e.preventDefault(),e.stopPropagation(),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation(),!1}{const o=Math.abs(e.pageX-Smart.ListBox.DragDrop.StartPosition.left),r=Math.abs(e.pageY-Smart.ListBox.DragDrop.StartPosition.top),n=new Date-Smart.ListBox.DragDrop.StartTime;let s=o>=5&&o<=15||r>=5&&r<=15;if(Smart.Utilities.Core.isMobile&&(n<300||n>1e3)&&(s=!1),s){Smart.ListBox.DragDrop.Dragging=!0,Smart.ListBox.DragDrop.Feedback.style.left=i[0]+e.pageX+"px",Smart.ListBox.DragDrop.Feedback.style.top=i[1]+e.pageY+"px",t.getShadowRootOrBody().appendChild(Smart.ListBox.DragDrop.Feedback),e.preventDefault(),e.stopPropagation(),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();const o=Smart.ListBox.DragDrop.Item,r=o.ownerListBox;r.$.fireEvent("dragStart",{item:o,data:Smart.ListBox.DragDrop,container:r,previousContainer:r,originalEvent:e.originalEvent}),document.body.classList.add("smart-dragging")}}}_focusHandler(){this._focused=!0,this.setAttribute("focus","")}_blurHandler(){this._focused=!1,this.removeAttribute("focus")}appendChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}t.isVirtualized?(t._items.indexOf(e)>-1&&t._items.splice(t._items.indexOf(e),1),t._items.push(e)):(e.dataItem=e,t.shadowRoot&&"light"===t.shadowDomMode?t.appendChild(e):t.$.itemsInnerContainer.appendChild(e),t._items.indexOf(e)>-1&&t._items.splice(t._items.indexOf(e),1),t._items.push(e)),t._refreshItems(),t._refreshSelection()}insertBefore(e,t){const i=this;if(!i.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.insertBefore.apply(i,e.concat(Array.prototype.slice.call(arguments)))}i.isVirtualized?(i._items.indexOf(e)>-1&&i._items.splice(i._items.indexOf(e),1),i._items.splice(i._indexOf(t),0,e)):(e.dataItem=e,t.parentNode.insertBefore(e,t),i._items.indexOf(e)>-1&&i._items.splice(i._items.indexOf(e),1),i._items.splice(i._indexOf(t),0,e)),i._refreshItems(),i._refreshSelection()}removeChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}if(t.isVirtualized)t._items.splice(t._indexOf(e),1);else if(e.parentNode){const i=t.selectedIndexes.slice(0),o=t.selectedValues.slice(0),r=i.indexOf(e.dataIndex);e.parentNode.removeChild(e),r>-1&&(i.splice(r,1),o.splice(r,1),t.selectedIndexes=i,t.selectedValues=o)}t._refreshItems()}propertyChangedHandler(e,t,i){super.propertyChangedHandler(e,t,i);const o=this;switch(e){case"innerHTML":o.clearSelection(),o._dataBind(),o.innerHTML=o.content=Smart.Utilities.Core.html(o.$.content);break;case"dataSource":case"valueMember":case"groupMember":case"displayMember":o.clearSelection(),o._dataBind();break;case"disabled":case"unfocusable":o._setFocusable();break;case"displayLoadingIndicator":o._setLoadingIndicatorVisibility();break;case"filterable":o._refreshFilter(),o._refreshLayout();break;case"grouped":if(i?o._group():o._ungroup(),"radioButton"===o.selectionMode){if(o.selectedValues.length>0){const e=o.selectedValues;o.clearSelection(),o.select(e[0])}}else o._refreshSelection();o._refreshLayout();break;case"itemTemplate":{if(null===i||""===i)return o._items.map(e=>e.innerHTML=e.label),delete o._bindingDetails,void o._refreshLayout();const e=o.querySelectorAll("smart-list-item"),t=function(){o._handleItemTemplate(i)&&(o._items.map(e=>o._applyTemplate(e)),o._refreshLayout()),o.ownerElement&&o.ownerElement._setDropDownSize&&o.ownerElement._setDropDownSize(),o.$.fireEvent("bindingComplete")};0===e.length?t():o._ensureItemsReady(e,t);break}case"selectedIndexes":case"selectedValues":{let r=o.selectedIndexes.slice(0),n=o.selectedValues.slice(0);if(!o._items||0===o._items.length)return o.selectedIndexes=[],o.selectedValues=[],void(o.$.hiddenInput.value=o.selectedValues.toString());if(o._propertyChanging=!0,"selectedIndexes"===e){r=t.slice(0),o.clearSelection();for(let e=0;e<i.length;e++){const t=i[e],r=o._items[t];r&&("oneOrManyExtended"===o.selectionMode||"oneOrMany"===o.selectionMode?(o.selectedIndexes.length>0&&0===e&&o.clearSelection(),o._select(r)):o.select(r))}}else{n=t.slice(0),o.selectedValues=[],o.clearSelection();for(let e=0;e<i.length;e++){const t=i[e],r=o.getItem(t);r&&("oneOrManyExtended"===o.selectionMode?o._select(r):o.select(r))}}if(o.selectedIndexes.length>0&&o._focus(o._items[o.selectedIndexes[0]]),o._propertyChanging=!1,JSON.stringify(n)!==JSON.stringify(o.selectedValues.slice(0))){let e=[],t=[];for(let e=0;e<r.length;e++)o.selectedIndexes.indexOf(r[e])<0&&t.push(o._items[r[e]]);for(let t=0;t<o.selectedIndexes.length;t++)r.indexOf(o.selectedIndexes[t])<0&&e.push(o._items[o.selectedIndexes[t]]);let i={addedItems:e,removedItems:t};if(o.selectedIndexes.length>0){const e=o._items[o.selectedIndexes[o.selectedIndexes.length-1]];void 0!==e&&(i.selected=e.selected,i.disabled=e.disabled,i.index=o._indexOf(e),i.label=e.label,i.value=e.value)}else i.selected=!1,i.disabled=!1,i.index=-1,i.label="",i.value="";o.$.fireEvent("change",i)}break}case"selectionMode":{const e="checkBox"===o.selectionMode||"radioButton"===o.selectionMode?o.selectionMode:"plain",r=o.selectedIndexes.slice(0),n=o.selectedValues.slice(0);o._propertyChanging=!0;const s=o.selectedValues;o.setAttribute("aria-multiselectable",-1!==["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox","radioButton"].indexOf(i)),o.selectedValues=[],o.clearSelection();for(let e=0;e<s.length;e++){const t=s[e],i=o.getItem(t);i&&("oneOrManyExtended"===o.selectionMode?o._select(i):o.select(i))}if(o._items.forEach(t=>t.displayMode=e),o._recycle(),o._propertyChanging=!1,JSON.stringify(n)!==JSON.stringify(o.selectedValues.slice(0))){let e=[],t=[];for(let e=0;e<r.length;e++)o.selectedIndexes.indexOf(r[e])<0&&t.push(o._items[r[e]]);for(let t=0;t<o.selectedIndexes.length;t++)r.indexOf(o.selectedIndexes[t])<0&&e.push(o._items[o.selectedIndexes[t]]);let i={addedItems:e,removedItems:t};if(r.length>0){const e=o._items[r[r.length-1]];e&&(i.selected=e.selected,i.disabled=e.disabled,i.index=o._indexOf(e),i.label=e.label,i.value=e.value)}o.$.fireEvent("change",i)}o._applyAriaSelected(),"checkBox"!==i&&"radioButton"!==i&&"checkBox"!==t&&"radioButton"!==t||o._refreshLayout();break}case"topVisibleIndex":o._setTopVisibleIndex(i);break;case"autoSort":o._canSort=i;break;case"sortDirection":case"sorted":{o._canSort=!0,i?o._sort():o._unsort();const e=o.selectedValues;o.selectedValues=[],o._refreshSelection();for(let t=0;t<e.length;t++){const i=e[t],r=o.getItem(i);r&&("oneOrManyExtended"===o.selectionMode?o._select(r):o.select(r))}o._refreshLayout(),o._canSort=o.autoSort;break}}}_refreshSelection(){const e=this;if(!e._items||0===e._items.length)return;const t=e.selectedValues;e.selectedIndexes=[],e.selectedValues=[];for(let i=0;i<e._items.length;i++){const o=e._items[i];o.selected=!1,t.indexOf(o.value)>-1&&e.select(o)}e._recycle()}clearSelection(){const e=this;if(!e._items||0===e._items.length)return;let t=[];for(let i=0;i<e._items.length;i++)e._items[i].selected&&t.push(e._items[i]);e._items.map(e=>e.selected=!1);e.selectedValues.slice(0);const i=e.selectedIndexes.slice(0);if(e.selectedIndexes=[],e.selectedValues=[],e.$.hiddenInput.value=e.selectedValues.toString(),e._recycle(),e.context!==e){let o={addedItems:[],removedItems:t};if(i.length>0){const t=e._items[i[i.length-1]];t&&(o.selected=t.selected,o.disabled=t.disabled,o.index=e._indexOf(t),o.label=t.label,o.value=t.value)}e.$.fireEvent("change",o)}}ensureVisible(e){const t=this;if(e)return!("string"==typeof e&&!(e=t.getItem(e)))&&(t.isVirtualized||t.$.itemsContainer.scrollTop===t.scrollTop||(t.scrollTop=t.$.itemsContainer.scrollTop),e.top+e.height>=t.scrollTop+t.offsetHeight&&(t.scrollTop=t.scrollTop+e.height,t.isVirtualized||(t.$.itemsContainer.scrollTop=t.scrollTop)),(e.top<=t.scrollTop||e.top>=t.scrollTop+t.$.itemsContainer.offsetHeight)&&(t.scrollTop=e.top,t.isVirtualized||(t.$.itemsContainer.scrollTop=t.scrollTop)),0===t._indexOf(e)||1===t._indexOf(e)&&t._items.length>1&&t._items[0].grouped?(t.scrollTop=0,t.isVirtualized||(t.$.itemsContainer.scrollTop=t.scrollTop)):t._indexOf(e)===t._items.length-1&&(t.scrollTop=t.scrollHeight,t.isVirtualized||(t.$.itemsContainer.scrollTop=t.scrollTop)),!0)}get items(){const e=this;return e._filteredItems?e._filteredItems:e._items}ready(){super.ready();const e=this;if(e.shadowRoot&&"light"===e.shadowDomMode){const t=document.createDocumentFragment();[].slice.call(e.$.itemsInnerContainer.children).map(e=>t.appendChild(e)),e.appendChild(t),e.$.itemsInnerContainer.appendChild(document.createElement("slot"))}e._areCSSVarsSupported=Smart.Utilities.Core.CSSVariablesSupport(),e.isUpdating=0,e._scrollView&&(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar),e._scrollView.hScrollBar.$.addClass("smart-hidden"),e._scrollView.vScrollBar.$.addClass("smart-hidden"));const t=e._scrollView.vScrollBar,i=e._scrollView.hScrollBar;t.hasStyleObserver=!1,i.hasStyleObserver=!1,t.hasResizeObserver=!1,i.hasResizeObserver=!1,t.wait=!1,i.wait=!1,e._setFocusable()}render(){const e=this;e.setAttribute("role","listbox"),e.setAttribute("aria-orientation","vertical"),e.$.verticalScrollBar.setAttribute("aria-controls",e.id),e.$.horizontalScrollBar.setAttribute("aria-controls",e.id),e._keysPressed={},e._incrementalSearchQuery="",e._incrementalSearchItems=[],e._canSort=!0,e._previousEntry="",e._setLoadingIndicatorVisibility(),e._refreshFilter(),e._initializeInnerHTML(),e._dataBind(),e.enableShadowDOM&&HTMLElement.prototype.appendChild.apply(e,[e.$.hiddenInput]),e.setAttribute("aria-multiselectable",-1!==["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox","radioButton"].indexOf(e.selectionMode)),super.render()}attached(){const e=this;super.attached(),Smart.ListBox.DragDrop||(Smart.ListBox.DragDrop={ListBoxes:[]}),Smart.ListBox.DragDrop.ListBoxes.push(e),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar)),e.selectedIndexes.length>0&&e._items&&e.ensureVisible(e._items[e.selectedIndexes[0]])}detached(){const e=this;if(super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView),Smart.ListBox.DragDrop&&Smart.ListBox.DragDrop.ListBoxes){const t=Smart.ListBox.DragDrop.ListBoxes.indexOf(e);Smart.ListBox.DragDrop.ListBoxes.splice(t,1)}}_createItem(e,t,i){const o="checkBox"===this.selectionMode||"radioButton"===this.selectionMode?this.selectionMode:"plain",r=i?{}:document.createElement("smart-list-item");r.ownerListBox=this,"number"==typeof e&&(e=""+e);const n=function(t,i){return void 0!==e[t]?""+e[t]:e[i]};let s="string"==typeof e?e:n(this.displayMember,"label"),l="string"==typeof e?e:n(this.valueMember,"value"),a=n(this.groupMember,"group");return void 0===s&&(s=void 0!==t?""+t:""),r.label=r.innerHTML=""+s,void 0===l&&(l=void 0!==t?""+t:s),e.color&&(r.color=e.color),r.value=""+l,r.displayMode=o,r.selected=!!e.selected&&e.selected,r.disabled=!!e.disabled&&e.disabled,r.dataItem=r,void 0!==t&&(r.dataIndex=t),this._alternateItem(r),e.title&&(r.title=e.title),a&&(r.group=""+a),r}_alternateItem(e){const t=this,i=t.alternationStart,o=t.alternationEnd>0?t.alternationEnd:1/0;t.alternationCount<=0||(void 0===t._alternationIndexCounter&&(t._alternationIndexCounter=0),e.dataIndex>=i&&e.dataIndex<=o&&(e.alternationIndex=t._alternationIndexCounter++,t._alternationIndexCounter===t.alternationCount&&(t._alternationIndexCounter=0)))}_beginUpdate(){this.isUpdating++}_isUpdating(){return this.isUpdating>0}_endUpdate(){this.isUpdating--}get _scrollHeight(){const e=this;if(0===e._items.length||e._items.filter(e=>!e.hidden).length<2)return 0;let t=0;if(e.isVirtualized){if(e.__scrollHeight)return e.__scrollHeight;if(0===e._items.length)return 0;e.isUpdating++;const i=e._createItem(e.dataSource[0]);e.$.itemsInnerContainer.appendChild(i);for(let o=0;o<e._items.length;o++){const r=e._items[o];r.hidden?(r.height=0,r.top=t):(e.itemHeight?(e.itemHeight<32&&(e.itemHeight=32),r.height=e.itemHeight):(i.$&&i.$.itemContainer?i.$.itemContainer.firstElementChild.innerHTML=r.label:i.label=r.label,r.height=i.offsetHeight),r.top=t,t+=r.height)}e.$.itemsInnerContainer.removeChild(i),e.__scrollHeight=t-e.$.itemsInnerContainer.offsetHeight,e.filterable&&(e.__scrollHeight+=e.$.filterInput.offsetHeight),t=e.__scrollHeight,e.isUpdating--}else{for(let i=0;i<e._items.length;i++){const o=e._items[i];o.hidden?(o.height=0,o.top=t):(e.itemHeight?"auto"!==e.itemHeight&&(o.height=e.itemHeight,o.style.height=o.height+"px"):o.height=o.offsetHeight,o.top=o.offsetTop,t+=o.height)}t=e.$.itemsInnerContainer.scrollHeight-e.$.itemsInnerContainer.offsetHeight,e.filterable&&t>0&&(t+=e.$.filterInput.offsetHeight),e.__scrollHeight=t}return t}_initializeRecyclingItems(){const e=this;if(!e.dataSource||e.dataSource&&0===e.dataSource.length||!e.isVirtualized)return;let t=0,i=e.offsetHeight||400;e.$.itemsInnerContainer.innerHTML="",e._recyclingItems=[];const o=function(){for(let o=0;o<e.dataSource.length;o++){const r=e.dataSource[o],n=e._createItem(r);if(e.itemHeight&&"auto"!==e.itemHeight&&(n.style.height=e.itemHeight+"px"),e.$.itemsInnerContainer.appendChild(n),t+=n.offsetHeight,n.dataItem=e._items[o],e._recyclingItems.push(n),t>1.5*i)break}};o();let r=0;for(;t<1.5*i&&++r<5;)o()}_dataBind(){const e=this;if(e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar)),"function"==typeof e.dataSource&&(e._items=[],delete e._filteredItems),"string"==typeof e.dataSource&&(e.dataSource=JSON.parse(e.dataSource)),null!==e.dataSource&&Array.isArray(e.dataSource)){e.isUpdating++;const t=t=>{e._items=[],e._groups=[],delete e._filteredItems;const i=e.dataSource;for(let o=0;o<i.length;o++){const r=i[o],n=e._createItem(r,o,!t);e._items[o]=n,t&&t.appendChild(n)}};if(e.isVirtualized)t(),e._initializeRecyclingItems();else{const i=document.createDocumentFragment();e.$.itemsInnerContainer.innerHTML="",t(i),e.$.itemsInnerContainer.appendChild(i)}e.isUpdating--}const t=e.shadowRoot?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item"),i=function(){e.isUpdating++,e.dataSource||(e._initializeHtmlListItems(),e._initializeHtmlListGroups()),e.grouped&&e._group(),e.sorted&&e._sort(),e._refreshLayout(),e._initializeSelection(),e.isInitialized=!0,e._canSort=e.autoSort,e.isUpdating--,e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&(e._items.map(t=>e._applyTemplate(t)),e._refreshLayout()),e.__onCompleted&&(e._onCompleted=e.__onCompleted,e.__onCompleted=null,e._onCompleted()),e.topVisibleIndex>-1&&e._setTopVisibleIndex(e.topVisibleIndex),e.$.fireEvent("bindingComplete"),e._updateTopVisibleIndex(),0===e._items.length&&e.clearItems(),e._applyAriaSelected()};0===t.length?i():(e._onCompleted&&(e.__onCompleted=e._onCompleted,e._onCompleted=null),e._ensureItemsReady(t,i))}_ensureItemsReady(e,t){const i=this,o=function(){const i=function(t){for(let i=0;i<e.length;i++)e[i].context="node"===t?e[i]:document};i("node"),t(),i()};if(0===e.length)o();else{i._nodesReadyListeners=0;for(let t=0;t<e.length;t++){const r=e[t],n=function(){i._nodesReadyListeners--,0===i._nodesReadyListeners&&(o(),delete i._nodesReadyListeners)}.bind(i);r.isCompleted||(i._nodesReadyListeners++,r._onCompleted=n)}0===i._nodesReadyListeners&&o()}}_initializeInnerHTML(){const e=this;e.$.itemsInnerContainer.innerHTML.indexOf("<option")>=0?e.$.itemsInnerContainer.innerHTML=e.$.itemsInnerContainer.innerHTML.replace(/<optgroup/gi,"<smart-list-items-group").replace(/<\/optgroup/gi,"</smart-list-items-group").replace(/<option/gi,"<smart-list-item").replace(/<\/option/gi,"</smart-list-item"):e.$.itemsInnerContainer.innerHTML.indexOf("<ul")>=0&&(e.$.itemsInnerContainer.innerHTML=e.$.itemsInnerContainer.innerHTML.replace(/<ul/gi,"<smart-list-items-group").replace(/<\/ul/gi,"</smart-list-items-group").replace(/<li/gi,"<smart-list-item").replace(/<\/li/gi,"</smart-list-item"))}_initializeHtmlListItems(){const e=this,t=e.shadowRoot&&"shadow"===e.shadowDomMode?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item"),i="checkBox"===e.selectionMode||"radioButton"===e.selectionMode?e.selectionMode:"plain",o=function(e,t,i){return void 0!==e[t]?""+e[t]:e[i]};e._items=[];let r=0;for(let n=0;n<t.length;n++){const s=t[n];s.dataIndex=n,s.label=s.innerHTML,s.dataItem=s,s.top||(s.top=r),s.height||(s.height=s.offsetHeight),r+=s.height,s.value||(s.value=""+n);const l=o(s,e.displayMember,"label"),a=o(s,e.valueMember,"value"),d=o(s,e.groupMember,"group");s.label!==l&&(s.label=l),s.value!==a&&(s.value=a),s.group!==d&&(s.group=d);const c=s.context;s.context=document,s.displayMode=i,s.context=c,e._alternateItem(s),s.selected&&(e.selectedIndexes.push(n),e.selectedValues.push(s.value)),e._items.push(s)}e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&e._items.map(t=>e._applyTemplate(t))}_group(){const e=this;e.isUpdating++;let t=[],i=[];e._canSort&&e._unsort();for(let i=0;i<e._items.length;i++){const o=e._items[i];let r=o.group?o.group.trim():o.innerHTML.charAt(0)||o.label.charAt(0);r+=" ",t[r]?t[r].items.push(o):t[t.length++]=t[r]={items:[o],label:r}}if(e.isVirtualized){e._groups=[];for(let e=0;e<t.length;e++){const o=t[e];o.dataIndex=e,o.grouped=!0,o.hidden=!1,o.displayMode="plain",i.push(o);for(let r=0;r<t[e].items.length;r++){const e=o.items[r];e.group=o,i.push(e)}}e._groups=t,e._items=i}else{for(;e.$.itemsInnerContainer.firstChild;)e.$.itemsInnerContainer.removeChild(e.$.itemsInnerContainer.firstChild);const o=document.createDocumentFragment();e._groups=[];for(let r=0;r<t.length;r++){const n=t[r],s=document.createElement("smart-list-items-group");s.label=n.label,s.dataIndex=r;for(let e=0;e<t[r].items.length;e++){const t=n.items[e];i.push(t),t.group=n.label,s.appendChild(t)}e._groups.push(s),o.appendChild(s)}e._items=i,/Trident|Edge/.test(navigator.userAgent)?setTimeout((function(){e.$.itemsInnerContainer.appendChild(o)}),50):e.$.itemsInnerContainer.appendChild(o)}e.sorted&&e._sort(),e.isUpdating--}_ungroup(){const e=this;e.isUpdating++,e._groups=[],e._canSort&&e._unsort();let t=[];if(e.isVirtualized)for(let i=0;i<e._items.length;i++){const o=e._items[i];o.grouped||t.push(o)}else{const i=document.createDocumentFragment();for(let o=0;o<e._items.length;o++){const r=e._items[o];i.appendChild(r),t.push(r)}t.length>0&&(e.$.itemsInnerContainer.innerHTML="",e.$.itemsInnerContainer.appendChild(i))}e._items=t,e.sorted&&e._sort(),e.isUpdating--}_initializeHtmlListGroups(){const e=this,t=e.$.itemsInnerContainer.querySelectorAll("smart-list-items-group");e._groups=[];for(let i=0;i<t.length;i++){const o=t[i];o.dataIndex=i,e._groups.push(o)}}_initializeSelection(){const e=this,t=e.selectedIndexes.slice(0),i=e.selectedValues.slice(0);e.clearSelection(),"oneOrManyExtended"===e.selectionMode&&(e._keysPressed.Control=!0);for(let o=0;o<e._items.length;o++){const r=e._items[o];(t.indexOf(o)>=0||i.indexOf(r.value||r.label)>=0)&&(e._focusedItem&&(e._focusedItem._focused=!1),e._focusedItem=null,e.select(r))}"oneOrManyExtended"===e.selectionMode&&(e._keysPressed.Control=!1)}onItemUpdated(){this.isInitialized&&!this._isUpdating()&&(this.isUpdating++,this._refreshLayout(),this.isUpdating--)}_refreshItems(){const e=this;if(e.isInitialized&&!e._isUpdating()){if(e.isUpdating++,e.grouped?e._ungroup():e.sorted&&e._canSort&&e._unsort(),!e.isVirtualized){e._items=[];const t=e.shadowRoot?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item");for(let i=0;i<t.length;i++)t[i].dataIndex=i,e._alternateItem(t[i]),e._items.push(t[i])}e.grouped?e._group():e.sorted&&e._sort(),e._refreshLayout(),e.isUpdating--}}_applyIncrementalSearch(e){const t=this;null===t.incrementalSearchDelay||isNaN(t.incrementalSearchDelay)||["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control","Home","End","PageUp","PageDown"].indexOf(e)>-1||(0!==t._incrementalSearchQuery.indexOf(e)&&(t._incrementalSearchQuery+=e),t._incrementalSearchTimer&&clearTimeout(t._incrementalSearchTimer),t._incrementalSearch(),t._incrementalSearchTimer=setTimeout((function(){t._incrementalSearchQuery=""}),t.incrementalSearchDelay))}select(e){const t=this;if(("string"!=typeof e||(e=t.getItem(e)))&&("number"!=typeof e||(e=t.getItem(e)))&&!(e.grouped||e.readonly||!t._items.length||e instanceof HTMLElement&&!t.contains(e))){if("none"===t.selectionMode)return t.selectedIndexes=[],void(t.selectedValues=[]);switch(!t._focusedItem!==e&&"none"!==t.selectionMode&&(t._focusedItem&&(t._focusedItem._focused=!1),t._focusedItem=e,e._focused=!0),t.selectionMode){case"one":return(1!==t.selectedIndexes.length||t.selectedIndexes[0]!==t._indexOf(e))&&(t._previouslySelectedIndexes=t.selectedIndexes,t.selectedIndexes.length>=1&&t.clearSelection(),t._select(e),delete t._previouslySelectedIndexes,!0);case"zeroOrOne":return 1===t.selectedIndexes.length&&t.selectedIndexes[0]===t._indexOf(e)?(t.unselect(e),!0):(t._previouslySelectedIndexes=t.selectedIndexes,t.selectedIndexes.length>=1&&t.clearSelection(),t._select(e),delete t._previouslySelectedIndexes,!0);case"radioButton":if(t._previouslySelectedIndexes=t.selectedIndexes,t.$.itemsInnerContainer.querySelectorAll("smart-list-items-group").length>0){const i=e.parentNode;if(!e.selected){for(let e in i.children){const o=i.children[e];o.selected&&t.unselect(o)}t._select(e)}return delete t._previouslySelectedIndexes,!0}if(t.isVirtualized&&t._groups.length>0){const i=e.group;if(!e.selected){for(let e in i.items){const o=i.items[e];o.selected&&t.unselect(o)}t._select(e)}return delete t._previouslySelectedIndexes,!0}return e.selected||(t.selectedIndexes.length>=1&&t.clearSelection(),t._select(e)),delete t._previouslySelectedIndexes,!0;case"oneOrMany":return e.selected?t.selectedIndexes.length>1&&t.unselect(e):t._select(e),!0;case"zeroOrMany":case"checkBox":return e.selected?t.unselect(e):t._select(e),!0;case"oneOrManyExtended":{const i=t.selectedValues;if(t._keysPressed.Control)return t.selectedIndexes.length>1&&e.selected?(t.unselect(e),t._focus(t._items[t.selectedIndexes[0]])):t._select(e),!0;if(t._keysPressed.Shift){const o=t._items[t.selectedIndexes[0]];let r;t.clearSelection();const n=i.indexOf(o.value)>=0||o.selected;if(t._select(o,n),t._indexOf(o)>t._indexOf(e))for(r=t._indexOf(o)-1;r>=t._indexOf(e);){const e=t._items[r],o=i.indexOf(e.value)>=0||e.selected;t._select(e,o),r--}else for(r=t._indexOf(o)+1;r<=t._indexOf(e);){const e=t._items[r],o=i.indexOf(e.value)>=0||e.selected;t._select(e,o),r++}const s=[];for(let e=0;e<i.length;e++)s.push(t.getItem(i[e]));if(s.length>0&&!t._propertyChanging){let o=[];for(let e=0;e<t.selectedValues.length;e++){const r=t.selectedValues[e];i.indexOf(r)<0&&o.push(t.getItem(r))}t.$.fireEvent("change",{addedItems:o,removedItems:s,selected:e.selected,disabled:e.disabled,index:t._indexOf(e),label:e.label,value:e.value})}return!0}for(let o=0;o<i.length;o++){const r=i[o],n=t.getItem(r);e!==n&&t.unselect(n)}return t.clearSelection(),t._select(e,i.indexOf(e.value)>=0),!0}}return!1}}_applyTemplate(e,t){const i=this;if(null===i.itemTemplate)return;if("function"==typeof i.itemTemplate)return void i.itemTemplate(e,{label:e.label,value:e.value,index:i._items.indexOf(e)});if(!i._bindingDetails||0===i._bindingDetails.length)return;const o=i._bindingDetails.length;let r,n,s=document.importNode(i._template.content,!0);for(let t=0;t<o;t++){r=s.childNodes[i._bindingDetails[t].childNodeIndex],n=i._bindingDetails[t].bindingString.length;for(let o=0;o<n;o++){const n=i._bindingDetails[t].bindingString[o],s=n.indexOf("label")>=0?e.label:e.value;r.innerHTML=r.innerHTML.replace(n,s)}}e.innerHTML="";for(let t=0;t<s.childNodes.length;t++)s.childNodes[t].outerHTML&&(e.innerHTML+=s.childNodes[t].outerHTML);!1!==t&&(i._scrollHeightTimer&&(clearInterval(i._scrollHeightTimer),i._scrollHeightCounter=0),i._scrollHeightTimer=setInterval((function(){i._lastScrollHeight===i.$.itemsInnerContainer.scrollHeight&&10!==i._scrollHeightCounter||(i._refreshLayout(),clearInterval(i._scrollHeightTimer)),i._lastScrollHeight=i.$.itemsInnerContainer.scrollHeight,i._scrollHeightCounter++}),50))}_filterItems(e,t,i){const o=this,r=o.$.filterInput.value;let n,s;const l=function(){if(0===s.length)return o._filteredItems=[],void(t&&t());n=o._queryItems(r,o.filterMode);for(let e=0;e<s.length;e++)s[e].hidden=!0,s[e].$.addClass("smart-hidden");for(let e=0;e<n.length;e++){const t=n[e];t.hidden=!1,t.$.removeClass("smart-hidden")}if(o.grouped&&o.isVirtualized)for(let e=0;e<o._groups.length;e++){const t=o._groups[e],i=t.items;let r=!0;for(let e=0;e<i.length;e++)i[e].hidden||(r=!1);r&&(t.hidden=!0)}if(o.grouped&&!o.isVirtualized)for(let e=0;e<o._groups.length;e++){const t=o._groups[e],i=[].concat(...t.querySelectorAll("smart-list-item"));let r=!0;for(let e=0;e<i.length;e++)i[e].$.hasClass("smart-hidden")||(r=!1);r?t.$.addClass("smart-hidden"):t.$.removeClass("smart-hidden")}o._filteredItems=n,o._refreshLayout(),t&&t(),e||o._refreshSelection()};if("function"==typeof o.dataSource)if(r||i){const e=function(e){(r||i)&&o.isAttached&&(o._updateListBoxAfterQuery=function(){n=s=o._items,l()},o.clearItems(),o.insert(0,e))},t=o.dataSource(r,e);if(t){if(!r&&!i)return;o._updateListBoxAfterQuery=function(){n=s=o._items,l()},o.clearItems(),o.insert(0,t)}}else o.clearItems(),n=s=o._items,l(),o.$.fireEvent("bindingComplete");else{if(s=o._items,0===s.length)return;l()}}_getNextItem(e){const t=this._items,i=this._items.length;let o=Math.max(e+1,0);for(;o<i;){const e=t[o];if(!(e.disabled||e.hidden||e.grouped||e.readonly))return e;o++}return t[e]}_getPreviousItem(e){const t=this._items;let i=Math.max(e-1,0);for(;i>-1;){const e=t[i];if(!(e.disabled||e.hidden||e.grouped||e.readonly))return e;i--}return t[e]}get _scrollWidth(){const e=this,t=e._items;return e.__scrollWidth||(e.__scrollWidth=(()=>{const e=this,i=e.virtualized,o=e.itemMeasureMode;let r=0,n="";function s(t){const i=e._createItem({label:t});i.style.position="absolute",e.$.itemsContainer.appendChild(i),i.label=t,i.style.width="auto",i.isCompleted&&(i.$.itemContainer.style.width="auto");const o=getComputedStyle(i),r=parseInt(o.paddingLeft)+parseInt(o.paddingRight),n=i.$.itemContainer||i,s=n.offsetWidth+n.offsetLeft+r;return i.parentNode.removeChild(i),s}for(let e=0;e<t.length;e++){const l=t[e];if(!l.hidden)if("auto"===o){const e=i?l.label:l.textContent.trim();e.length>n.length&&(n=e)}else r=Math.max(r,s(l.label))}return"auto"===o?s(n):r})()),e.__scrollWidth}update(e,t){const i=this,o=i._items[e];if(o){if("string"==typeof t)o.label=t,void 0===o.value&&(o.value=t);else for(let e in t)"selected"===e&&o[e]!==t[e]?i.select(o):o[e]=t[e],"group"===e&&i._refreshItems();(i.sorted||i.grouped||i.isVirtualized)&&(i._refreshItems(),i._refreshSelection())}else i.error(i.localize("indexOutOfBound",{elementType:i.nodeName.toLowerCase(),method:"update"}))}insert(e,t){const i=this;let o=[];if(e||(e=0),Array.isArray(t)){i.isUpdating++;for(let r=0;r<t.length;r++){const n=t[r],s=i._createItem(n);o.push(s),e>=i._items.length||0===i._items.length?i.appendChild(s):i.insertBefore(s,i._items[e])}i.isUpdating--}else{const r=i._createItem(t);o.push(r),e>=i._items.length||0===i._items.length?i.appendChild(r):i.insertBefore(r,i._items[e])}o.length>0?(o.map(e=>i._applyTemplate(e)),i._ensureItemsReady(o,(function(){i._refreshItems(),0!==i._items.length&&(i._updateListBoxAfterQuery&&(i._updateListBoxAfterQuery(),delete i._updateListBoxAfterQuery),i._refreshSelection(),i.$.fireEvent("bindingComplete"))}))):i._updateListBoxAfterQuery&&(i._updateListBoxAfterQuery(),delete i._updateListBoxAfterQuery)}removeAt(e){const t=this,i=t._items[e];i?(i.selected&&t.unselect(i),t.isVirtualized?t._items.splice(e,1):i.parentNode.removeChild(i),t._refreshItems(),t._refreshSelection(),0===t.selectedIndexes.length&&t._items.length>0&&("oneOrMany"!==t.selectionMode&&"one"!==t.selectionMode&&"oneOrManyExtended"!==t.selectionMode||t.select(t._items[0]))):t.error(t.localize("indexOutOfBound",{elementType:t.nodeName.toLowerCase(),method:"remove"}))}_queryItems(e,t){const i=this,o=[],r=function(o,r){if(o.grouped)return o;switch(t){case"startsWith":if(0===o.label.indexOf(r))return o;break;case"startsWithIgnoreCase":if(0===o.label.toLowerCase().indexOf(r.toLowerCase()))return o;break;case"doesNotContain":if(o.label.indexOf(r)<0)return o;break;case"doesNotContainIgnoreCase":if(o.label.toLowerCase().indexOf(r.toLowerCase())<0)return o;break;case"contains":if(o.label.indexOf(r)>-1)return o;break;case"containsIgnoreCase":if(o.label.toLowerCase().indexOf(r.toLowerCase())>-1)return o;break;case"equals":if(0===o.label.localeCompare(r))return o;break;case"equalsIgnoreCase":if(0===o.label.toLowerCase().localeCompare(r.toLowerCase()))return o;break;case"endsWith":if(o.label.endsWith(r))return o;break;case"endsWithIgnoreCase":if(o.label.toLowerCase().endsWith(r.toLowerCase()))return o;break;case"custom":if(i.filterCallback(o,e))return o}return null};if(0===e.length)return i._items;for(let t=0;t<i._items.length;t++){const n=r(i._items[t],e);n&&o.push(n)}return o}_select(e,t){const i=this,o=i.selectedIndexes.indexOf(i._indexOf(e)),r=i.selectedIndexes.slice(0),n=i.selectedValues.slice(0);if(e.selected=!0,-1!==o)return i._recycle(),!1;if(r.push(i._indexOf(e)),n.push(e.value||e.label),i.selectedIndexes=r,i.selectedValues=n,i._recycle(),i.$.hiddenInput.value=n.toString(),!i.isCompleted||t||!i.isInitialized||i._propertyChanging)return;let s=[];if(i._previouslySelectedIndexes){for(let e=0;e<i._previouslySelectedIndexes.length;e++)i.selectedIndexes.indexOf(i._previouslySelectedIndexes[e])<0&&s.push(i._items[i._previouslySelectedIndexes[e]]);delete i._previouslySelectedIndexes}return i.$.fireEvent("change",{addedItems:[e],removedItems:s,selected:e.selected,disabled:e.disabled,index:i._indexOf(e),label:e.label,value:e.value}),!0}_setTopVisibleIndex(e){const t=this;if("number"==typeof e&&(t.topVisibleIndex=Math.max(0,e),e=t._items[t.topVisibleIndex]),!e)return!1;e.top!==t.scrollTop&&(t.scrollTop=e.top,t.isVirtualized||(t.$.itemsContainer.scrollTop=t.scrollTop),t.scrollHeight===t.scrollTop&&t._updateTopVisibleIndex())}_updateTopVisibleIndex(){const e=this,t=e.scrollTop+e._scrollView.verticalScrollBar.offsetHeight-e.offsetHeight;let i;if(e.scrollTop<e.scrollHeight/2){for(let o=0;o<e._items.length;o++)if(e._items[o].top>=t){i=e._items[o];break}}else for(let o=e._items.length-1;o>=0&&!(e._items[o].top<t);o--)i=e._items[o];i&&(e.topVisibleIndex=i.dataIndex)}unselect(e){const t=this;if(!e)return;if("string"==typeof e&&!(e=t.getItem(e)))return;if("none"===t.selectionMode)return void t.clearSelection();const i=t.selectedIndexes.indexOf(t._indexOf(e)),o=t.selectedIndexes.slice(0),r=t.selectedValues.slice(0);return e.selected=!1,i>=0&&(o.splice(i,1),r.splice(i,1),t.selectedIndexes=o,t.selectedValues=r,t.$.hiddenInput.value=r.toString(),t.isCompleted&&!t._propertyChanging?(t.$.fireEvent("change",{addedItems:[],removedItems:[e],selected:e.selected,disabled:e.disabled,index:t._indexOf(e),label:e.label,value:e.value}),t._recycle(),!0):void 0)}_handleItemTemplate(e){if(null===e||!e)return;if("function"==typeof e)return e;const t=this;if(!("content"in document.createElement("template")))return t.error(t.localize("htmlTemplateNotSuported",{elementType:t.nodeName.toLowerCase()})),void(t.itemTemplate=null);if(null===(e=document.getElementById(e))||!("content"in e))return t.error(t.localize("invalidTemplate",{elementType:t.nodeName.toLowerCase(),property:"itemTemplate"})),void(t.itemTemplate=null);const i=e.content,o=i.childNodes.length,r=/{{\w+}}/g;let n,s;t._bindingDetails=[],t._template=e;for(let e=0;e<o;e++){for(s=[];n=r.exec(i.childNodes[e].innerHTML);)s.push(n[0]);s.length>0&&t._bindingDetails.push({childNodeIndex:e,bindingString:s})}return!0}_handleKeyStrokes(e){const t=this,i="radioButton"===t.selectionMode||"checkBox"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode;let o=t._items;if(t.filterable&&t.$.filterInput.value.length>0&&(o=t._filteredItems),!t.disabled&&!t.readonly&&o.length){switch(e){case"ArrowLeft":case"ArrowUp":t._handleArrowKeys(!0);break;case"ArrowRight":case"ArrowDown":t._handleArrowKeys(!1);break;case" ":{if(t.selectedIndexes.length<1&&!t._focusedItem)return;const e=t._focusedItem?t._focusedItem:t._items[t.selectedIndexes[t.selectedIndexes.length-1]],i=e=>{e.selected&&"radioButton"!==t.selectionMode?t.unselect(e):t.select(e)};if("oneOrMany"===t.selectionMode)return void(e.selected&&t.selectedIndexes.length>1?i(e):e.selected||i(e));i(e);break}case"Home":if(0===o.length)return;i||(t._keysPressed.Shift||t.clearSelection(),t.select(o[0])),t._focus(o[0]),t.scrollTop=0;break;case"End":if(0===o.length)return;i||(t._keysPressed.Shift||t.clearSelection(),t.select(o[o.length-1])),t._focus(o[o.length-1]),t.scrollTop=t.scrollHeight;break;case"PageUp":t._pageUpKeyHandler(o);break;case"PageDown":t._pageDownKeyHandler(o)}t._recycle()}}_horizontalScrollbarHandler(e){const t=this;e.stopPropagation(),t.isVirtualized?t._recycle():t.$.itemsContainer.scrollLeft=t._getScrollLeft(e.detail.value)}_getScrollLeft(e,t){const i=this;if(!i.rightToLeft)return e;if(Smart.Utilities.Core.Browser.Chrome){if(!t){const e=2*(parseInt(getComputedStyle(i.$.itemsInnerContainer).getPropertyValue("--smart-list-item-horizontal-offset"))||0);t=i._scrollWidth-i.$.itemsContainer.offsetWidth-e}e=t-e}else e*=-1;return e}_unsort(){const e=this;e.isUpdating++;const t=function(e,t){let i=e.dataIndex,o=t.dataIndex;return i<o?-1:i>o?1:0};if(e.isVirtualized)if(e._groups.length>0){e._groups.sort(t);let i=[];for(let o=0;o<e._groups.length;o++){const r=e._groups[o],n=[].concat(...r.items);n.sort(t),i.push(r),i=i.concat(n)}e._items=i}else e._items.sort(t);else{if(e._groups.length>0){e._groups.sort(t);let i=[];for(let o=0;o<e._groups.length;o++){const r=e._groups[o],n=[].concat(...r.querySelectorAll("smart-list-item"));n.sort(t),i=i.concat(n)}e._items=i}else e._items.sort(t);e._applySortOrder()}e.isUpdating--}_applySortOrder(){const e=function(e){for(let t=0;t<e.length;t++){const i=e[t],o=i.parentNode;o&&o.appendChild(i)}};e(this._items),e(this._groups)}_sort(){const e=this;if(!e._canSort)return;e.isUpdating++;const t=function(t,i){let o=t.label,r=i.label;if("asc"===e.sortDirection){if(o<r)return-1;if(o>r)return 1}else{if(o<r)return 1;if(o>r)return-1}return 0};if(e._groups.sort(t),e.isVirtualized)if(e._groups.length>0){let i=[];for(let o=0;o<e._groups.length;o++){const r=e._groups[o],n=[].concat(...r.items);i.push(r),n.sort(t),i=i.concat(n)}e._items=i}else e._items.sort(t);else{if(e._groups.length>0){let i=[];for(let o=0;o<e._groups.length;o++){const r=e._groups[o],n=[].concat(...r.querySelectorAll("smart-list-item"));n.sort(t),i=i.concat(n)}e._items=i}else e._items.sort(t);e._applySortOrder()}e.isUpdating--}getItem(e){const t=this;for(let i=0;i<t._items.length;i++)if(t._items[i].value===e)return t._items[i];return null}_focus(e){const t=this;!e||"none"===t.selectionMode||t.disabled||t.readonly||(t._focusedItem&&(t._focusedItem._focused=!1),t._focusedItem=e,t._focusedItem._focused=!0)}_keyDownHandler(e){const t=this,i=(t.shadowRoot||t.getRootNode()).activeElement||document.activeElement;let o=e.key;if(!t.disabled&&!t.readonly&&(!t.filterable||t.$.filterInput!==i)&&t._focused&&0!==t._items.length&&!t.disabled&&!t.displayLoadingIndicator){if(t.editable){if("F2"===o)return void t._dblclickEventHandler({target:t._focusedItem});if(t.$.editInput===i)return}if("none"!==t.selectionMode){switch(e.stopPropagation(),o){case"Down":case"Right":case"Left":case"Up":o="Arrow"+o}if(t.filterable)switch(o){case"ArrowLeft":case"ArrowRight":return;case"ArrowUp":case"ArrowDown":e.preventDefault()}if(t._applyIncrementalSearch(o),!(["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control"," ","Home","End","PageUp","PageDown"].indexOf(o)<0))if(e.preventDefault(),!t._focusedItem&&t._items.length>0)"one"===t.selectionMode||"oneOrMany"===t.selectionMode||"oneOrManyExtended"===t.selectionMode?t.select(t._items[0]):t._focus(t._items[0]);else switch(t.selectionMode){case"one":if("Shift"===o||"Control"===o||" "===o)return;t._handleKeyStrokes(o);break;case"oneOrMany":case"zeroOrOne":case"zeroOrMany":case"radioButton":case"checkBox":if("Shift"===o||"Control"===o)return;t._handleKeyStrokes(o);break;case"oneOrManyExtended":if(" "===o)return;t._keysPressed[o]="keydown"===e.type,t._handleKeyStrokes(o)}}}}_keyUpHandler(e){const t=this,i=(t.shadowRoot||t.getRootNode()).activeElement||document.activeElement;if(!t.editable||t.$.editInput!==i){if(t.filterable&&t.$.filterInput===i)return t._filterTimer&&clearTimeout(t._filterTimer),void(t._filterTimer=setTimeout((function(){const e=t.context;t.context=t,t._filterItems(),t.scrollTop=t.$.itemsContainer.scrollTop=0,t.scrollLeft=t.$.itemsContainer.scrollLeft=t._getScrollLeft(0),t.context=e}),300));if(t._focused){if(t._focusedItem&&t._focusedItem.hidden&&t._filteredItems.length>0){let e=t._filteredItems[0];e.grouped&&t._filteredItems.length>1&&(e=t._filteredItems[1]),t._focus(e),t._recycle()}e.stopPropagation(),e.preventDefault(),t.disabled||["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control"," ","PageUp","PageDown"].indexOf(e.key)<0||(t._keysPressed[e.key]=!1)}}}_mouseWheelHandler(e){const t=this;if((t.computedHorizontalScrollBarVisibility||t.computedVerticalScrollBarVisibility)&&!t.disabled&&t.computedVerticalScrollBarVisibility){const i=t.scrollTop;if(0===i&&e.deltaY<0||i===t.scrollHeight&&e.deltaY>0)return;e.stopPropagation(),e.preventDefault(),t.scrollTo(i+t._getScrollCoefficient(e,t.offsetHeight))}}_pageDownKeyHandler(e){const t=this;if(0===e.length)return;let i,o=t._items[t.selectedIndexes[t.selectedIndexes.length-1]];if("checkBox"!==t.selectionMode&&"radioButton"!==t.selectionMode&&"zeroOrMany"!==t.selectionMode&&"oneOrMany"!==t.selectionMode&&"zeroOrOne"!==t.selectionMode||t._focusedItem&&(o=t._focusedItem),!o)return;const r=t._indexOf(o);let n=o.top+t.$.itemsContainer.offsetHeight-o.height;for(let t=r;t<e.length;t++)if(e[t].top>=n){i=e[t];break}i||(i=e[e.length-1]),"checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode?t._focus(i):i.selected||(t._keysPressed.Shift||t.clearSelection(),t.select(i),t._focus(i)),(i.height+i.top>t.$.itemsContainer.scrollTop+t.$.itemsContainer.offsetHeight||i.top<t.$.itemsContainer.scrollTop)&&(t.scrollTop=i.top-t.$.itemsContainer.offsetHeight+i.height)}_pageUpKeyHandler(e){const t=this;if(0===e.length)return;let i=t._items[t.selectedIndexes[t.selectedIndexes.length-1]];if("checkBox"!==t.selectionMode&&"radioButton"!==t.selectionMode&&"zeroOrMany"!==t.selectionMode&&"oneOrMany"!==t.selectionMode&&"zeroOrOne"!==t.selectionMode||t._focusedItem&&(i=t._focusedItem),!i)return;const o=i.top-t.$.itemsContainer.offsetHeight;let r;for(let n=t._indexOf(i);n>0;n--)if(e[n].top<=o){r=e[n];break}r||(r=e[0]),"checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode?t._focus(r):r.selected||(t._keysPressed.Shift||t.clearSelection(),t.select(r),t._focus(r)),t.scrollTop=r.top,0===t._indexOf(r)&&(t.scrollTop=0)}clearItems(){this.clearSelection(),this.$.itemsInnerContainer.innerHTML="",this._items=[],delete this._focusedItem,this.$placeholder.removeClass("smart-hidden")}_resizeHandler(e){const t=this;e.target!==t||t._isUpdatingScrollBars||(t._isUpdatingScrollBars=!0,t._initializeRecyclingItems(),t._refreshLayout(),t._isUpdatingScrollBars=!1)}_indexOf(e){const t=this;if(!e)return-1;let i=t._items.indexOf(e);return-1===i&&(i=t._items.indexOf(t.getItem(e.value))),i}_incrementalSearch(){const e=this,t="radioButton"!==e.selectionMode&&"checkBox"!==e.selectionMode&&"zeroOrMany"!==e.selectionMode&&"oneOrMany"!==e.selectionMode&&"zeroOrOne"!==e.selectionMode;let i,o=0;switch(e.incrementalSearchMode){case"containsIgnoreCase":case"equalsIgnoreCase":case"startsWithIgnoreCase":case"endsWithIgnoreCase":i=e._incrementalSearchQuery.toLowerCase();break;default:i=e._incrementalSearchQuery}const r=function(i){i.grouped||i.readonly||(t?(e.selectedIndexes.length>0&&e.clearSelection(),e._focus(i),e.select(i)):e._focus(i),(i.height+i.top>e.$.itemsContainer.scrollTop+e.$.itemsContainer.offsetHeight||i.top<e.scrollTop)&&(e.scrollTop=i.top),0===e._indexOf(i)&&(e.scrollTop=0),e._indexOf(i)===e._items.length-1&&(e.scrollTop=e.scrollHeight))};0!==e._previousEntry.localeCompare(i)&&(e._incrementalSearchItems=e._queryItems(e._incrementalSearchQuery,e.incrementalSearchMode),delete e._itemPosition),e._previousEntry=i;const n=e._incrementalSearchItems.length;if(0!==n)if(1!==n)for(void 0!==e._itemPosition?e._itemPosition<n-1?o=e._itemPosition:(o=0,t?(e._incrementalSearchItems[e._itemPosition].selected=!1,e.selectedIndexes=[],e.selectedValues=[]):e._incrementalSearchItems[e._itemPosition]._focused=!1):t&&e.clearSelection();o<n;o++)if(e._incrementalSearchItems[o].selected&&t)e._incrementalSearchItems[o].selected=!1,e.selectedIndexes=[],e.selectedValues=[];else{if(t||!e._incrementalSearchItems[o]._focused)return r(e._incrementalSearchItems[o]),void(e._itemPosition=o);e._incrementalSearchItems[o]._focused=!1}else r(e._incrementalSearchItems[0])}_selectStartHandler(e){const t=(this.shadowRoot||this.getRootNode()).activeElement;this.$.filterInput!==t&&this.$.editInput!==t&&e.preventDefault()}_handleArrowKeys(e){const t=this,i="radioButton"!==t.selectionMode&&"checkBox"!==t.selectionMode&&"zeroOrMany"!==t.selectionMode&&"oneOrMany"!==t.selectionMode&&"zeroOrOne"!==t.selectionMode;if(t.disabled||t.readonly)return;let o;if(t._focusedItem&&!t._keysPressed.Shift)o=t._indexOf(t._focusedItem),t._focusedItem._focused=!1;else{if(0===t.selectedIndexes.length)return;o=t.selectedIndexes[t.selectedIndexes.length-1]}const r=e?t._getPreviousItem(o):t._getNextItem(o);t._focus(r),i&&(t._keysPressed.Shift?t.select(r):t._items[o]!==r&&(t.clearSelection(),t.select(r))),t.ensureVisible(r)}_refreshFilter(){const e=this;if(e.filterable)return e.$.filterInput.disabled=!(!e.disabled&&!e.displayLoadingIndicator),e.$filterInputContainer.removeClass("smart-hidden"),void e.$itemsContainer.addClass("filter");e.$.filterInput.disabled=!0,e.$filterInputContainer.addClass("smart-hidden"),e.$itemsContainer.removeClass("filter")}_setFocusable(){const e=this;e.disabled||e.unfocusable?e.removeAttribute("tabindex"):e.tabIndex=e.tabIndex>0?e.tabIndex:0}_setLoadingIndicatorVisibility(){const e=this;e.displayLoadingIndicator?e.$loadingIndicatorContainer.hasClass("smart-visibility-hidden")?e.$loadingIndicatorContainer.removeClass("smart-visibility-hidden"):e.$loadingIndicatorContainer.removeClass("smart-hidden"):e._areCSSVarsSupported?e.$loadingIndicatorContainer.addClass("smart-hidden"):e.$loadingIndicatorContainer.addClass("smart-visibility-hidden")}_refreshLayout(){const e=this,t=e._filteredItems||e._items;if(e.__scrollHeight=null,e.__scrollWidth=null,e._height=null,e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar)),e.$itemsContainer.removeClass("hscroll"),e.$itemsContainer.removeClass("vscroll"),!t||null===t||0===t.length)return e.scrollWidth=0,e.scrollHeight=0,e.$filterInputContainer.removeClass("vscroll"),e.$placeholder.removeClass("smart-hidden"),e.isVirtualized&&e._recycle(),void(e.$.itemsInnerContainer.style.width="");e.$placeholder.addClass("smart-hidden");const i=2*(parseInt(getComputedStyle(e.$.itemsContainer).getPropertyValue("--smart-list-item-horizontal-offset"))||0);let o=e._scrollWidth-e.$.itemsContainer.offsetWidth-i,r=e._scrollHeight;if(e._refreshHorizontalScrollBarVisibility(o),e._refreshVerticalScrollBarVisibility(r),e.$.itemsInnerContainer.style.width="","hidden"===e.horizontalScrollBarVisibility?e.$.itemsInnerContainer.style.width=e.$.itemsContainer.offsetWidth-i:e.$.itemsInnerContainer.style.width=Math.max(e.$.itemsContainer.offsetWidth-i,-i+e.__scrollWidth)+"px",e.computedVerticalScrollBarVisibility)return o=e._scrollWidth-e.$.itemsContainer.offsetWidth-i,e._refreshHorizontalScrollBarVisibility(o),"hidden"!==e.horizontalScrollBarVisibility&&(e.$.itemsInnerContainer.style.width="",e.$.itemsInnerContainer.style.width=Math.max(e.$.itemsContainer.offsetWidth-i,-i+e.__scrollWidth)+"px"),e.computedHorizontalScrollBarVisibility&&(("visible"!==e.horizontalScrollBarVisibility||0!==e.scrollWidth||"visible"===e.horizontalScrollBarVisibility)&&(e.__scrollHeight+=e._scrollView.hScrollBar.offsetHeight),e.scrollHeight=e.__scrollHeight),void(e.isVirtualized&&e._recycle());o=e._scrollWidth-e.$.itemsContainer.offsetWidth-i,e._refreshHorizontalScrollBarVisibility(o),e.computedHorizontalScrollBarVisibility&&(e.scrollHeight=e._scrollHeight,e._refreshVerticalScrollBarVisibility(e.scrollHeight),e.computedVerticalScrollBarVisibility&&(o=e._scrollWidth-e.$.itemsContainer.offsetWidth-e._scrollView.vScrollBar.offsetWidth,e._refreshHorizontalScrollBarVisibility(o)),e._scrollView.vScrollBar.$.hasClass("bottom-corner")&&e._scrollView.vScrollBar.refresh()),e.isVirtualized&&e._recycle();const n=/Trident|Edge/.test(navigator.userAgent);!e.isRefreshing&&n&&setTimeout((function(){e.isRefreshing=!0,e._refreshLayout(),e.isRefreshing=!1}),50)}_styleChangedHandler(){this._refreshLayout()}_swipeLeftHandler(){}_swipeRightHandler(){}_refreshHorizontalScrollBarVisibility(e){const t=this;t.scrollWidth=e,t.computedHorizontalScrollBarVisibility?(t.scrollLeft=t._getScrollLeft(t.$.itemsContainer.scrollLeft,e),t.$itemsContainer.addClass("hscroll")):t.$itemsContainer.removeClass("hscroll")}_refreshVerticalScrollBarVisibility(e){const t=this;t.scrollHeight=e,t.computedVerticalScrollBarVisibility?(t.$itemsContainer.addClass("vscroll"),t.$filterInputContainer.addClass("vscroll")):(t.$itemsContainer.removeClass("vscroll"),t.$filterInputContainer.removeClass("vscroll"))}_validateTemplate(e,t){if(null===t||!t)return;const i=this;return"content"in document.createElement("template")?null!==(t=document.getElementById(t))&&"content"in t?t:(i.error(i.localize("invalidTemplate",{elementType:i.nodeName.toLowerCase(),property:e})),void(i[e]=null)):(i.error(i.localize("htmlTemplateNotSuported",{elementType:i.nodeName.toLowerCase()})),void(i[e]=null))}_getItemIndexByPosition(e){const t=this;return(i=>{let o=0,r=i.length-1;if(e<=0)return 0;if(i[i.length-1].top<=e)return i.length-1;for(;;){const n=Math.floor((o+r)/2),s=i[n];if(t._isItemInPosition(s,e))return n;s.top<e?o=n+1:s.top>e&&(r=n-1)}})(t.filterable&&t.$.filterInput.value.length>0?t._filteredItems:t._items)}_isItemInPosition(e,t){const i=e.top,o=e.top+e.height;return i<=t&&o>t}get isVirtualized(){return this.virtualized&&this.dataSource&&this.dataSource.length>0}_recycle(){const e=this;if(!e._recyclingItems)return;let t=e._height;e._height||(t=e._height=e.$.itemsContainer.offsetHeight);let i=0;const o=e.scrollTop,r=e._getItemIndexByPosition(o),n=e.filterable&&e.$.filterInput.value.length>0?e._filteredItems:e._items,s=n[r];let l=s?s.top:0;if(e.$.itemsInnerContainer.style.left=-e.scrollLeft+"px",e.$.itemsInnerContainer.style.top=-o+l+"px",e.isUpdating++,r>=0){const s=n.length;for(let a=r;a<s;a++){const r=n[a];if(0!==r.height){if(!(l+r.height>=o&&l<=o+t))break;{const t=e._recyclingItems[i++];if(!t)break;t.setAttribute("aria-setsize",s),t.setAttribute("aria-posinset",a),t.context=document,t.dataItem=r,t.label=r.label,t.value=r.value,t.selected=r.selected,t._focused=r._focused,t.hidden=r.hidden,t.grouped=r.grouped,t.readonly=r.readonly,t.style.height=r.height+"px",e._alternateItem(t),r.title?t.title=r.title:t.title="",r.grouped?t.displayMode="plain":t.displayMode=r.displayMode,e.scrollWidth>0&&(t.style.width=e.$.itemsInnerContainer.offsetWidth+e.scrollWidth+"px"),e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&e._applyTemplate(t,!1)}l+=r.height}}}if(i<e._recyclingItems.length)for(let t=i;t<e._recyclingItems.length;t++){const t=e._recyclingItems[i++],o=t.context;t.context=document,t.hidden=!0,t.context=o}e.isUpdating--}_verticalScrollbarHandler(e){const t=this,i=e.detail.value;e.stopPropagation(),t.isVirtualized?t._recycle():t.$.itemsContainer.scrollTop=i,t._updateTopVisibleIndex(),e.context.max!==e.context.value?e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"):t.$.fireEvent("scrollBottomReached")}_applyAriaSelected(){const e=this.isVirtualized?this._recyclingItems:this._items,t=this.selectionMode;for(let i=0;i<e.length;i++){const o=e[i];o.selected?o.setAttribute("aria-selected",!0):o.readonly||o.disabled||-1===["oneOrManyExtended","zeroOrMany","oneOrMany","checkBox"].indexOf(t)?o.removeAttribute("aria-selected"):o.setAttribute("aria-selected",!1)}}})}});